<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinView - User Profile & Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: #2a2a2a;
            --bg-glass: rgba(42, 42, 42, 0.8);
            --neon-mint: #00E38C;
            --neon-glow: rgba(0, 227, 140, 0.3);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-subtle: rgba(255, 255, 255, 0.1);
            --success: #00E38C;
            --warning: #ffa502;
            --danger: #ff4757;
            --info: #70a1ff;
        }

        /* Navbar Styles */
        .navbar {
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 227, 140, 0.2);
            padding: 1rem 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1050;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--neon-mint) !important;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        .nav-link {
            color: var(--text-secondary) !important;
            font-weight: 500;
            margin: 0 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--neon-mint) !important;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background: var(--neon-mint);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after, .nav-link.active::after {
            width: 100%;
        }

        .navbar-toggler {
            border: none;
            color: var(--neon-mint);
            font-size: 1.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Profile Header */
        .profile-header {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-mint), #00b894);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--bg-primary);
            margin: 0 auto 1.5rem;
            box-shadow: 0 0 30px var(--neon-glow);
            transition: all 0.3s ease;
        }

        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px var(--neon-glow);
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .profile-email {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .risk-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(0, 227, 140, 0.3);
        }

        .risk-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .risk-value {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-low { background: rgba(0, 227, 140, 0.2); color: var(--neon-mint); border: 1px solid var(--neon-mint); }
        .risk-medium { background: rgba(255, 165, 2, 0.2); color: var(--warning); border: 1px solid var(--warning); }
        .risk-high { background: rgba(255, 71, 87, 0.2); color: var(--danger); border: 1px solid var(--danger); }

        /* Card Styles */
        .dashboard-card {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 32px rgba(0, 227, 140, 0.1);
            border-color: rgba(0, 227, 140, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-icon {
            color: var(--neon-mint);
            font-size: 1.1rem;
        }

        .btn-custom {
            background: var(--neon-mint);
            border: none;
            color: var(--bg-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--neon-glow);
            background: var(--neon-mint);
            color: var(--bg-primary);
        }

        /* Budget Table */
        .budget-table {
            width: 100%;
            border-collapse: collapse;
        }

        .budget-table th,
        .budget-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-subtle);
        }

        .budget-table th {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .budget-category {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .budget-amount {
            font-weight: 600;
            color: var(--neon-mint);
        }

        /* Watchlist Cards */
        .watchlist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .asset-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .asset-card:hover {
            border-color: var(--neon-mint);
            box-shadow: 0 4px 16px var(--neon-glow);
            transform: translateY(-2px);
        }

        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .asset-info h6 {
            margin: 0;
            font-weight: 600;
            font-size: 1rem;
        }

        .asset-category {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .asset-price {
            text-align: right;
        }

        .price-value {
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0;
        }

        .price-change {
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 0.25rem;
        }

        .positive { color: var(--neon-mint); }
        .negative { color: var(--danger); }

        .mini-trend {
            height: 40px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Investment Portfolio */
        .investment-portfolio {
            min-height: 200px;
        }

        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .investment-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
            position: relative;
        }

        .investment-card:hover {
            border-color: var(--neon-mint);
            box-shadow: 0 4px 16px var(--neon-glow);
            transform: translateY(-2px);
        }

        .investment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .investment-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .investment-type {
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: rgba(0, 227, 140, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--neon-mint);
        }

        .investment-amount {
            text-align: right;
        }

        .amount-invested {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--neon-mint);
            margin-bottom: 0.25rem;
        }

        .amount-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .investment-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .detail-item {
            text-align: center;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border: 1px solid var(--border-subtle);
        }

        .detail-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .investment-actions {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-subtle);
            color: var(--text-primary);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .action-btn:hover {
            background: var(--neon-mint);
            color: var(--bg-primary);
            border-color: var(--neon-mint);
            transform: scale(1.1);
        }

        .empty-portfolio {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }

        .empty-portfolio i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-portfolio h6 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        /* Risk Assessment */
        .question-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-subtle);
        }

        .question-text {
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-subtle);
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
        }

        .option-btn:hover {
            border-color: var(--neon-mint);
            background: rgba(0, 227, 140, 0.1);
        }

        .option-btn.selected {
            background: var(--neon-mint);
            color: var(--bg-primary);
            border-color: var(--neon-mint);
            box-shadow: 0 0 15px var(--neon-glow);
        }

        /* Goals Progress */
        .goal-item {
            margin-bottom: 1.5rem;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .goal-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .goal-percentage {
            font-weight: 700;
            color: var(--neon-mint);
        }

        .progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--neon-mint), #00b894);
            border-radius: 4px;
            transition: width 1s ease-in-out;
            box-shadow: 0 0 10px var(--neon-glow);
        }

        .goal-amount {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 1rem 0;
            }

            .profile-header {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }

            .profile-avatar {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }

            .profile-name {
                font-size: 1.5rem;
            }

            .dashboard-card {
                padding: 1.25rem;
                margin-bottom: 1rem;
            }

            .budget-table {
                font-size: 0.9rem;
            }

            .budget-table th,
            .budget-table td {
                padding: 0.75rem 0.5rem;
            }

            .watchlist-grid {
                grid-template-columns: 1fr;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--neon-mint);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Authentication Styles */
        .auth-container {
            min-height: calc(100vh - 80px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }

        .auth-card {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2.5rem;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 100%;
            margin: 0 auto;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--neon-mint);
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px var(--neon-glow);
        }

        .auth-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 14px 16px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--neon-mint);
            box-shadow: 0 0 20px var(--neon-glow);
            outline: none;
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .btn-auth {
            background: var(--neon-mint);
            border: none;
            color: var(--bg-primary);
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            width: 100%;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-auth:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--neon-glow);
        }

        .btn-google {
            background: #ffffff;
            color: #333333;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .btn-google:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        .auth-divider {
            text-align: center;
            margin: 1.5rem 0;
            position: relative;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-subtle);
        }

        .auth-divider span {
            background: var(--bg-glass);
            padding: 0 1rem;
            position: relative;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .auth-switch {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-secondary);
        }

        .auth-switch a {
            color: var(--neon-mint);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid var(--danger);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--danger);
            margin-bottom: 1rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .hidden {
            display: none !important;
        }

        /* Profile View Styles */
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border-subtle);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--neon-mint);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .logout-btn {
            background: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">FinView</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="budget-tracker.html">Budget Tracker</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="investment-analytics.html">Investments</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="ai-investment-chat.html">AI Advisor</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="user-profile-dashboard.html">Profile</a>
                    </li>
                </ul>
            </div>
    </nav>

    <div class="main-container" style="margin-top: 80px;">
        <!-- Authentication Container -->
        <div id="authContainer" class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <h2 class="auth-title">FinView</h2>
                    <p class="auth-subtitle" id="authSubtitle">Sign in to your account</p>
                </div>

                <div id="errorMessage" class="error-message"></div>

                <!-- Sign In Form -->
                <div id="signinForm">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="signinUsername" class="form-control" placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="signinPassword" class="form-control" placeholder="Enter your password">
                    </div>
                    <button class="btn-auth" onclick="handleSignin()">
                        <i class="fas fa-sign-in-alt me-2"></i>Sign In
                    </button>
                </div>

                <!-- Sign Up Form -->
                <div id="signupForm" class="hidden">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="signupFullName" class="form-control" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="signupUsername" class="form-control" placeholder="Choose a username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="signupEmail" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="signupPassword" class="form-control" placeholder="Create a password">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" class="form-control" placeholder="Confirm your password">
                    </div>
                    <button class="btn-auth" onclick="handleSignup()">
                        <i class="fas fa-user-plus me-2"></i>Sign Up
                    </button>
                </div>

                <div class="auth-divider">
                    <span>or continue with</span>
                </div>

                <button class="btn-auth btn-google" onclick="handleGoogleSignin()">
                    <i class="fab fa-google"></i>
                    Continue with Google
                </button>

                <div class="auth-switch">
                    <span id="authSwitchText">Don't have an account?</span>
                    <a href="#" id="authSwitchLink" onclick="toggleAuthMode()">Sign Up</a>
                </div>
            </div>
        </div>

        <!-- Profile Content (Hidden by default) -->
        <div id="profileContent" class="hidden">
            <!-- Profile Header -->
            <div class="profile-header fade-in">
                <div class="profile-avatar" id="profileAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <h1 class="profile-name" id="userName">Loading...</h1>
                <p class="profile-email" id="userEmail">Loading...</p>
                <div class="profile-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="accountCreated">-</div>
                        <div class="stat-label">Account Created</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="lastLogin">-</div>
                        <div class="stat-label">Last Login</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalTransactions">0</div>
                        <div class="stat-label">Total Transactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalBalance">₹0</div>
                        <div class="stat-label">Total Balance</div>
                    </div>
                </div>
                <div class="risk-display">
                    <span class="risk-label">Risk Tolerance:</span>
                    <span class="risk-value" id="riskValue">Not Assessed</span>
                </div>
                <div style="text-align: center; margin-top: 1.5rem;">
                    <button class="logout-btn" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </button>
                </div>
            </div>

        <div class="row">
            <!-- Saved Budgets Section -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-wallet card-icon"></i>
                            Saved Budgets
                        </h5>
                        <button class="btn-custom" onclick="addNewBudget()">
                            <i class="fas fa-plus me-1"></i>Add Budget
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="budget-table" id="budgetTable">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Month</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="budgetTableBody">
                                <tr>
                                    <td colspan="4" class="text-center text-muted">
                                        <div class="spinner"></div>
                                        Loading budgets...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Saved Watchlist -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-star card-icon"></i>
                            Watchlist
                        </h5>
                        <button class="btn-custom" onclick="manageWatchlist()">
                            <i class="fas fa-edit me-1"></i>Manage
                        </button>
                    </div>
                    <div class="watchlist-grid" id="watchlistGrid">
                        <div class="text-center text-muted">
                            <div class="spinner"></div>
                            Loading watchlist...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Investment Portfolio -->
            <div class="col-lg-6 mb-4">
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-chart-pie card-icon"></i>
                            Investment Portfolio
                        </h5>
                        <button class="btn-custom" onclick="addNewInvestment()">
                            <i class="fas fa-plus me-1"></i>Add Investment
                        </button>
                    </div>
                    <div class="investment-portfolio" id="investmentPortfolio">
                        <div class="text-center text-muted">
                            <div class="spinner"></div>
                            Loading portfolio...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Risk Assessment Questionnaire -->
            <div class="col-lg-8 mb-4">
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-chart-line card-icon"></i>
                            Risk Assessment
                        </h5>
                        <button class="btn-custom" onclick="calculateRiskScore()">
                            <i class="fas fa-calculator me-1"></i>Calculate Score
                        </button>
                    </div>
                    <div id="questionnaireContainer">
                        <div class="text-center text-muted">
                            <div class="spinner"></div>
                            Loading questionnaire...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Goals -->
            <div class="col-lg-4 mb-4">
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-target card-icon"></i>
                            Financial Goals
                        </h5>
                        <button class="btn-custom" onclick="addNewGoal()">
                            <i class="fas fa-plus me-1"></i>Add Goal
                        </button>
                    </div>
                    <div id="goalsContainer">
                        <div class="text-center text-muted">
                            <div class="spinner"></div>
                            Loading goals...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="finview-admin-db.js"></script>
    <script>
        // FinView Users Database
        class FinViewUsersDB {
            constructor() {
                this.users = this.loadUsers();
            }

            loadUsers() {
                const stored = localStorage.getItem('FinViewUsersDB');
                return stored ? JSON.parse(stored) : [];
            }

            saveUsers() {
                localStorage.setItem('FinViewUsersDB', JSON.stringify(this.users));
            }

            generateUserId() {
                return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            hashPassword(password) {
                // Simple hash function for demo purposes
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString();
            }

            createUser(userData) {
                const newUser = {
                    userId: this.generateUserId(),
                    fullName: userData.fullName,
                    username: userData.username,
                    email: userData.email,
                    password: this.hashPassword(userData.password),
                    profileImage: userData.profileImage || '',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    totalIncome: 0,
                    totalExpense: 0,
                    balance: 0,
                    transactions: [],
                    riskTolerance: 'not-assessed',
                    riskScore: 0
                };

                this.users.push(newUser);
                this.saveUsers();
                return newUser;
            }

            findUserByUsername(username) {
                return this.users.find(user => user.username === username);
            }

            findUserByEmail(email) {
                return this.users.find(user => user.email === email);
            }

            findUserById(userId) {
                return this.users.find(user => user.userId === userId);
            }

            validatePassword(user, password) {
                return user.password === this.hashPassword(password);
            }

            updateLastLogin(userId) {
                const user = this.findUserById(userId);
                if (user) {
                    user.lastLogin = new Date().toISOString();
                    this.saveUsers();
                }
            }

            updateUserProfile(userId, updates) {
                const userIndex = this.users.findIndex(user => user.userId === userId);
                if (userIndex !== -1) {
                    this.users[userIndex] = { ...this.users[userIndex], ...updates };
                    this.saveUsers();
                    return this.users[userIndex];
                }
                return null;
            }

            isUsernameTaken(username) {
                return this.users.some(user => user.username === username);
            }

            isEmailRegistered(email) {
                return this.users.some(user => user.email === email);
            }
        }

        // Initialize database
        const finViewDB = new FinViewUsersDB();

        // Authentication Manager
        class AuthManager {
            constructor() {
                this.currentUser = null;
                this.loadCurrentUser();
            }

            loadCurrentUser() {
                const stored = localStorage.getItem('FinViewCurrentUser');
                if (stored) {
                    this.currentUser = JSON.parse(stored);
                }
            }

            saveCurrentUser() {
                if (this.currentUser) {
                    localStorage.setItem('FinViewCurrentUser', JSON.stringify(this.currentUser));
                    localStorage.setItem('isLoggedIn', 'true');
                } else {
                    localStorage.removeItem('FinViewCurrentUser');
                    localStorage.setItem('isLoggedIn', 'false');
                }
            }

            signup(userData) {
                // Validation
                if (!userData.fullName || !userData.username || !userData.email || !userData.password) {
                    throw new Error('All fields are required');
                }

                if (userData.password.length < 6) {
                    throw new Error('Password must be at least 6 characters long');
                }

                if (userData.password !== userData.confirmPassword) {
                    throw new Error('Passwords do not match');
                }

                if (finViewDB.isUsernameTaken(userData.username)) {
                    throw new Error('Username is already taken');
                }

                if (finViewDB.isEmailRegistered(userData.email)) {
                    throw new Error('Email is already registered');
                }

                // Create user
                const newUser = finViewDB.createUser(userData);
                this.currentUser = newUser;
                this.saveCurrentUser();
                
                return newUser;
            }

            signin(username, password) {
                const user = finViewDB.findUserByUsername(username);
                
                if (!user) {
                    throw new Error('Incorrect username or password. Please try again.');
                }

                if (!finViewDB.validatePassword(user, password)) {
                    throw new Error('Incorrect username or password. Please try again.');
                }

                // Update last login
                finViewDB.updateLastLogin(user.userId);
                
                this.currentUser = user;
                this.saveCurrentUser();
                
                // Log successful login to admin database
                try {
                    finViewAdminDB.addActivityLog(user.userId, {
                        page: 'User Profile',
                        action: 'Login',
                        description: `User logged in successfully from ${navigator.userAgent}`,
                        userAgent: navigator.userAgent,
                        url: window.location.href
                    });
                    console.log('✅ User login logged to Admin Database');
                } catch (error) {
                    console.error('Error logging login to admin database:', error);
                }
                
                return user;
            }

            signinWithGoogle(googleUserData) {
                // Check if user exists by email
                let user = finViewDB.findUserByEmail(googleUserData.email);
                
                if (!user) {
                    // Create new user with Google data
                    const newUserData = {
                        fullName: googleUserData.name,
                        username: googleUserData.email.split('@')[0],
                        email: googleUserData.email,
                        password: 'google-auth-' + Date.now(), // Random password for Google users
                        profileImage: googleUserData.picture || ''
                    };
                    user = finViewDB.createUser(newUserData);
                } else {
                    // Update last login for existing user
                    finViewDB.updateLastLogin(user.userId);
                }

                this.currentUser = user;
                this.saveCurrentUser();
                
                // Log Google login to admin database
                try {
                    finViewAdminDB.addActivityLog(user.userId, {
                        page: 'User Profile',
                        action: 'Google Login',
                        description: `User logged in with Google account: ${googleUserData.email}`,
                        userAgent: navigator.userAgent,
                        url: window.location.href
                    });
                    console.log('✅ Google login logged to Admin Database');
                } catch (error) {
                    console.error('Error logging Google login to admin database:', error);
                }
                
                return user;
            }

            signout() {
                // Log logout to admin database before clearing user
                if (this.currentUser) {
                    try {
                        finViewAdminDB.addActivityLog(this.currentUser.userId, {
                            page: 'User Profile',
                            action: 'Logout',
                            description: `User logged out from ${navigator.userAgent}`,
                            userAgent: navigator.userAgent,
                            url: window.location.href
                        });
                        console.log('✅ User logout logged to Admin Database');
                    } catch (error) {
                        console.error('Error logging logout to admin database:', error);
                    }
                }
                
                this.currentUser = null;
                this.saveCurrentUser();
            }

            isLoggedIn() {
                return this.currentUser !== null;
            }

            getCurrentUser() {
                return this.currentUser;
            }
        }

        // Initialize authentication manager
        const authManager = new AuthManager();

        // Dummy data (for reference, will be replaced)
        const dummyUserData = {
            name: "Alex Johnson",
            email: "alex.johnson@email.com",
            riskTolerance: "medium",
            riskScore: 65
        };

        const dummyBudgets = [
            { category: "Housing", amount: 25000, month: "November 2024", status: "on-track", icon: "fa-home", color: "#ff6b6b" },
            { category: "Food & Dining", amount: 8000, month: "November 2024", status: "over", icon: "fa-utensils", color: "#4ecdc4" },
            { category: "Transportation", amount: 5000, month: "November 2024", status: "under", icon: "fa-car", color: "#45b7d1" },
            { category: "Entertainment", amount: 3000, month: "November 2024", status: "on-track", icon: "fa-film", color: "#f9ca24" },
            { category: "Shopping", amount: 7000, month: "November 2024", status: "over", icon: "fa-shopping-bag", color: "#a55eea" },
            { category: "Savings", amount: 15000, month: "November 2024", status: "on-track", icon: "fa-piggy-bank", color: "#26de81" }
        ];

        const dummyWatchlist = [
            { name: "Apple Inc.", symbol: "AAPL", price: "₹18,247.50", change: "+2.45%", isPositive: true, category: "Technology" },
            { name: "Microsoft Corp", symbol: "MSFT", price: "₹4,12,350.00", change: "+1.87%", isPositive: true, category: "Technology" },
            { name: "Tesla Inc", symbol: "TSLA", price: "₹2,41,680.00", change: "-3.21%", isPositive: false, category: "Automotive" },
            { name: "Amazon.com", symbol: "AMZN", price: "₹1,68,420.00", change: "+0.95%", isPositive: true, category: "E-commerce" },
            { name: "Bitcoin", symbol: "BTC", price: "₹68,47,250.00", change: "+5.67%", isPositive: true, category: "Cryptocurrency" },
            { name: "NIFTY 50", symbol: "NIFTY", price: "₹18,247.60", change: "+1.24%", isPositive: true, category: "Index" }
        ];

        const riskQuestions = [
            {
                id: 1,
                question: "What is your investment time horizon?",
                options: [
                    { text: "Less than 1 year", value: 1 },
                    { text: "1-3 years", value: 2 },
                    { text: "3-7 years", value: 3 },
                    { text: "More than 7 years", value: 4 }
                ]
            },
            {
                id: 2,
                question: "How would you react to a 20% drop in your portfolio value?",
                options: [
                    { text: "Sell everything immediately", value: 1 },
                    { text: "Sell some investments", value: 2 },
                    { text: "Hold and wait", value: 3 },
                    { text: "Buy more at lower prices", value: 4 }
                ]
            },
            {
                id: 3,
                question: "What percentage of your income can you invest?",
                options: [
                    { text: "Less than 10%", value: 1 },
                    { text: "10-25%", value: 2 },
                    { text: "25-50%", value: 3 },
                    { text: "More than 50%", value: 4 }
                ]
            },
            {
                id: 4,
                question: "What is your primary investment goal?",
                options: [
                    { text: "Capital preservation", value: 1 },
                    { text: "Regular income", value: 2 },
                    { text: "Balanced growth", value: 3 },
                    { text: "Maximum growth", value: 4 }
                ]
            }
        ];

        const dummyGoals = [
            { name: "Emergency Fund", current: 250000, target: 500000, percentage: 50 },
            { name: "Dream Home", current: 1500000, target: 5000000, percentage: 30 },
            { name: "World Tour", current: 180000, target: 300000, percentage: 60 },
            { name: "Retirement", current: 2500000, target: 10000000, percentage: 25 }
        ];

        let userAnswers = {};
        let currentRiskScore = 0;

        // Authentication Functions
        let isSignUpMode = false;

        function toggleAuthMode() {
            isSignUpMode = !isSignUpMode;
            const signinForm = document.getElementById('signinForm');
            const signupForm = document.getElementById('signupForm');
            const authSubtitle = document.getElementById('authSubtitle');
            const authSwitchText = document.getElementById('authSwitchText');
            const authSwitchLink = document.getElementById('authSwitchLink');

            if (isSignUpMode) {
                signinForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                authSubtitle.textContent = 'Create your account';
                authSwitchText.textContent = 'Already have an account?';
                authSwitchLink.textContent = 'Sign In';
            } else {
                signinForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                authSubtitle.textContent = 'Sign in to your account';
                authSwitchText.textContent = "Don't have an account?";
                authSwitchLink.textContent = 'Sign Up';
            }

            hideError();
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.classList.remove('show');
        }

        function handleSignup() {
            try {
                hideError();

                const userData = {
                    fullName: document.getElementById('signupFullName').value.trim(),
                    username: document.getElementById('signupUsername').value.trim(),
                    email: document.getElementById('signupEmail').value.trim(),
                    password: document.getElementById('signupPassword').value,
                    confirmPassword: document.getElementById('signupConfirmPassword').value
                };

                const newUser = authManager.signup(userData);
                showProfileView();
                
            } catch (error) {
                showError(error.message);
            }
        }

        function handleSignin() {
            try {
                hideError();

                const username = document.getElementById('signinUsername').value.trim();
                const password = document.getElementById('signinPassword').value;

                if (!username || !password) {
                    showError('Please enter both username and password');
                    return;
                }

                const user = authManager.signin(username, password);
                showProfileView();
                
            } catch (error) {
                showError(error.message);
            }
        }

        function handleGoogleSignin() {
            try {
                hideError();

                // Simulate Google sign-in (in real implementation, this would use Google OAuth)
                const googleUserData = {
                    name: 'Google User',
                    email: 'google.user' + Date.now() + '@gmail.com',
                    picture: 'https://via.placeholder.com/150'
                };

                const user = authManager.signinWithGoogle(googleUserData);
                showProfileView();
                
            } catch (error) {
                showError('Google sign-in failed. Please try again.');
            }
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                authManager.signout();
                showAuthView();
                // Clear form fields
                document.getElementById('signinUsername').value = '';
                document.getElementById('signinPassword').value = '';
                document.getElementById('signupFullName').value = '';
                document.getElementById('signupUsername').value = '';
                document.getElementById('signupEmail').value = '';
                document.getElementById('signupPassword').value = '';
                document.getElementById('signupConfirmPassword').value = '';
            }
        }

        function showAuthView() {
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('profileContent').classList.add('hidden');
            document.querySelector('.main-container').style.marginTop = '80px';
        }

        function showProfileView() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('profileContent').classList.remove('hidden');
            document.querySelector('.main-container').style.marginTop = '80px';
            
            // Load real user data
            loadRealUserData();
            loadBudgets();
            loadWatchlist();
            loadInvestmentPortfolio();
            loadQuestionnaire();
            loadGoals();
        }

        function loadRealUserData() {
            const currentUser = authManager.getCurrentUser();
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.fullName;
                document.getElementById('userEmail').textContent = currentUser.email;
                
                // Update profile avatar if user has profile image
                const avatar = document.getElementById('profileAvatar');
                if (currentUser.profileImage) {
                    avatar.innerHTML = `<img src="${currentUser.profileImage}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                } else {
                    avatar.innerHTML = '<i class="fas fa-user"></i>';
                }

                // Update stats
                const createdDate = new Date(currentUser.createdAt);
                document.getElementById('accountCreated').textContent = createdDate.toLocaleDateString();
                
                const lastLoginDate = new Date(currentUser.lastLogin);
                document.getElementById('lastLogin').textContent = lastLoginDate.toLocaleDateString();
                
                document.getElementById('totalTransactions').textContent = currentUser.transactions.length;
                document.getElementById('totalBalance').textContent = formatCurrency(currentUser.balance);

                // Update risk tolerance
                const riskValue = document.getElementById('riskValue');
                riskValue.textContent = currentUser.riskTolerance.charAt(0).toUpperCase() + currentUser.riskTolerance.slice(1);
                riskValue.className = `risk-value risk-${currentUser.riskTolerance}`;
            }
        }

        // Initialize the page
        window.onload = function() {
            // Check if user is logged in
            if (authManager.isLoggedIn()) {
                showProfileView();
            } else {
                showAuthView();
            }
            
            // Log page visit to admin database
            if (authManager.isLoggedIn()) {
                const currentUser = authManager.getCurrentUser();
                try {
                    finViewAdminDB.addActivityLog(currentUser.userId, {
                        page: 'User Profile',
                        action: 'Page Visit',
                        description: 'User visited Profile page',
                        userAgent: navigator.userAgent,
                        url: window.location.href
                    });
                    console.log('✅ Profile page visit logged to Admin Database');
                } catch (error) {
                    console.error('Error logging page visit to admin database:', error);
                }
            }
        };

        function loadUserData() {
            // Simulate loading delay
            setTimeout(() => {
                const savedUserData = localStorage.getItem('finviewUserData');
                const userData = savedUserData ? JSON.parse(savedUserData) : dummyUserData;
                
                document.getElementById('userName').textContent = userData.name;
                document.getElementById('userEmail').textContent = userData.email;
                
                const riskValue = document.getElementById('riskValue');
                riskValue.textContent = userData.riskTolerance.charAt(0).toUpperCase() + userData.riskTolerance.slice(1);
                riskValue.className = `risk-value risk-${userData.riskTolerance}`;
                
                currentRiskScore = userData.riskScore || 0;
            }, 1000);
        }

        function loadBudgets() {
            setTimeout(() => {
                const tbody = document.getElementById('budgetTableBody');
                tbody.innerHTML = '';
                
                dummyBudgets.forEach(budget => {
                    const row = document.createElement('tr');
                    const statusClass = budget.status === 'over' ? 'text-danger' : 
                                      budget.status === 'under' ? 'text-success' : 'text-warning';
                    
                    row.innerHTML = `
                        <td>
                            <div class="budget-category">
                                <div class="category-icon" style="background: ${budget.color}20; color: ${budget.color};">
                                    <i class="fas ${budget.icon}"></i>
                                </div>
                                ${budget.category}
                            </div>
                        </td>
                        <td class="budget-amount">₹${budget.amount.toLocaleString()}</td>
                        <td>${budget.month}</td>
                        <td class="${statusClass}">
                            <i class="fas fa-circle me-1" style="font-size: 0.5rem;"></i>
                            ${budget.status.replace('-', ' ')}
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }, 800);
        }

        function loadWatchlist() {
            setTimeout(() => {
                const grid = document.getElementById('watchlistGrid');
                grid.innerHTML = '';
                
                dummyWatchlist.forEach(asset => {
                    const card = document.createElement('div');
                    card.className = 'asset-card';
                    card.innerHTML = `
                        <div class="asset-header">
                            <div class="asset-info">
                                <h6>${asset.name}</h6>
                                <div class="asset-category">${asset.category}</div>
                            </div>
                            <div class="asset-price">
                                <div class="price-value">${asset.price}</div>
                                <div class="price-change ${asset.isPositive ? 'positive' : 'negative'}">
                                    <i class="fas fa-arrow-${asset.isPositive ? 'up' : 'down'} me-1"></i>
                                    ${asset.change}
                                </div>
                            </div>
                        </div>
                        <div class="mini-trend">
                            <i class="fas fa-chart-line me-1"></i>
                            Mini trend chart placeholder
                        </div>
                    `;
                    
                    card.onclick = () => {
                        alert(`Opening detailed view for ${asset.name} (${asset.symbol})`);
                    };
                    
                    grid.appendChild(card);
                });
            }, 1200);
        }

        function loadQuestionnaire() {
            setTimeout(() => {
                const container = document.getElementById('questionnaireContainer');
                container.innerHTML = '';
                
                riskQuestions.forEach((q, index) => {
                    const questionCard = document.createElement('div');
                    questionCard.className = 'question-card fade-in';
                    questionCard.style.animationDelay = `${index * 0.1}s`;
                    
                    questionCard.innerHTML = `
                        <div class="question-text">${q.question}</div>
                        <div class="options-grid">
                            ${q.options.map((option, optIndex) => `
                                <button class="option-btn" 
                                        onclick="selectAnswer(${q.id}, ${option.value}, this)">
                                    ${option.text}
                                </button>
                            `).join('')}
                        </div>
                    `;
                    
                    container.appendChild(questionCard);
                });
            }, 1500);
        }

        function loadGoals() {
            setTimeout(() => {
                const container = document.getElementById('goalsContainer');
                container.innerHTML = '';
                
                dummyGoals.forEach((goal, index) => {
                    const goalItem = document.createElement('div');
                    goalItem.className = 'goal-item fade-in';
                    goalItem.style.animationDelay = `${index * 0.2}s`;
                    
                    goalItem.innerHTML = `
                        <div class="goal-header">
                            <span class="goal-name">${goal.name}</span>
                            <span class="goal-percentage">${goal.percentage}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" 
                                 style="width: 0%" 
                                 data-target="${goal.percentage}">
                            </div>
                        </div>
                        <div class="goal-amount">
                            <span>₹${goal.current.toLocaleString()}</span>
                            <span>₹${goal.target.toLocaleString()}</span>
                        </div>
                    `;
                    
                    container.appendChild(goalItem);
                    
                    // Animate progress bars
                    setTimeout(() => {
                        const progressBar = goalItem.querySelector('.progress-bar');
                        progressBar.style.width = `${goal.percentage}%`;
                    }, 500 + (index * 200));
                });
            }, 1000);
        }

        function selectAnswer(questionId, value, button) {
            // Remove selected class from all buttons in this question
            const questionCard = button.closest('.question-card');
            questionCard.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selected class to clicked button
            button.classList.add('selected');
            
            // Store answer
            userAnswers[questionId] = value;
            
            // Check if all questions are answered
            if (Object.keys(userAnswers).length === riskQuestions.length) {
                setTimeout(() => {
                    calculateRiskScore();
                }, 500);
            }
        }

        function calculateRiskScore() {
            if (Object.keys(userAnswers).length < riskQuestions.length) {
                alert('Please answer all questions before calculating your risk score.');
                return;
            }
            
            const totalScore = Object.values(userAnswers).reduce((sum, value) => sum + value, 0);
            const averageScore = totalScore / Object.keys(userAnswers).length;
            
            let riskTolerance, riskClass;
            if (averageScore <= 1.5) {
                riskTolerance = 'low';
            } else if (averageScore <= 2.5) {
                riskTolerance = 'medium';
            } else {
                riskTolerance = 'high';
            }
            
            currentRiskScore = Math.round(averageScore * 25); // Convert to 0-100 scale
            
            // Update UI
            const riskValue = document.getElementById('riskValue');
            riskValue.textContent = riskTolerance.charAt(0).toUpperCase() + riskTolerance.slice(1);
            riskValue.className = `risk-value risk-${riskTolerance}`;
            
            // Save to localStorage
            const userData = {
                name: document.getElementById('userName').textContent,
                email: document.getElementById('userEmail').textContent,
                riskTolerance: riskTolerance,
                riskScore: currentRiskScore
            };
            localStorage.setItem('finviewUserData', JSON.stringify(userData));
            
            // Show success message
            alert(`Your risk assessment is complete! You have a ${riskTolerance} risk tolerance with a score of ${currentRiskScore}/100.`);
        }

        function addNewBudget() {
            alert('Add New Budget functionality would open a modal/form here');
        }

        function manageWatchlist() {
            alert('Manage Watchlist functionality would open a detailed view here');
        }

        function addNewGoal() {
            alert('Add New Goal functionality would open a form here');
        }

        // Investment Portfolio Functions
        function addNewInvestment() {
            if (!authManager.isLoggedIn()) {
                alert('Please sign in to add investments');
                return;
            }

            const investmentName = prompt('Enter investment name (e.g., Apple Stock, Bitcoin, Mutual Fund):');
            if (!investmentName) return;

            const investmentType = prompt('Enter investment type (Stocks, Crypto, Mutual Funds, Bonds, Real Estate, Other):');
            if (!investmentType) return;

            const amountInvested = prompt('Enter amount invested (in ₹):');
            if (!amountInvested || isNaN(amountInvested) || parseFloat(amountInvested) <= 0) {
                alert('Please enter a valid amount');
                return;
            }

            const currentValue = prompt('Enter current value (in ₹):');
            if (!currentValue || isNaN(currentValue) || parseFloat(currentValue) < 0) {
                alert('Please enter a valid current value');
                return;
            }

            const purchaseDate = prompt('Enter purchase date (YYYY-MM-DD):');
            if (!purchaseDate || !isValidDate(purchaseDate)) {
                alert('Please enter a valid date (YYYY-MM-DD)');
                return;
            }

            const notes = prompt('Enter any additional notes (optional):');

            const currentUser = authManager.getCurrentUser();
            const investmentData = {
                name: investmentName.trim(),
                type: investmentType.trim(),
                amountInvested: parseFloat(amountInvested),
                currentValue: parseFloat(currentValue),
                purchaseDate: purchaseDate,
                notes: notes ? notes.trim() : '',
                createdAt: new Date().toISOString()
            };

            try {
                // Add to admin database
                finViewAdminDB.addInvestment(currentUser.userId, investmentData);
                
                // Log activity
                finViewAdminDB.addActivityLog(currentUser.userId, {
                    page: 'User Profile',
                    action: 'Add Investment',
                    description: `Added ${investmentType}: ${investmentName} - ₹${parseFloat(amountInvested).toLocaleString()}`
                });

                console.log('✅ Investment saved to Admin Database');
                alert('Investment added successfully!');
                loadInvestmentPortfolio();
            } catch (error) {
                console.error('Error saving investment:', error);
                alert('Error saving investment. Please try again.');
            }
        }

        function loadInvestmentPortfolio() {
            const portfolioContainer = document.getElementById('investmentPortfolio');
            
            if (!authManager.isLoggedIn()) {
                portfolioContainer.innerHTML = `
                    <div class="empty-portfolio">
                        <i class="fas fa-chart-pie"></i>
                        <h6>No Investments Yet</h6>
                        <p>Sign in to track your investment portfolio</p>
                    </div>
                `;
                return;
            }

            const currentUser = authManager.getCurrentUser();
            
            try {
                const userData = finViewAdminDB.getUserData(currentUser.userId);
                const investments = userData?.investments || [];

                if (investments.length === 0) {
                    portfolioContainer.innerHTML = `
                        <div class="empty-portfolio">
                            <i class="fas fa-chart-pie"></i>
                            <h6>No Investments Yet</h6>
                            <p>Click "Add Investment" to start tracking your portfolio</p>
                        </div>
                    `;
                    return;
                }

                let totalInvested = 0;
                let totalCurrent = 0;

                const portfolioHTML = investments.map(investment => {
                    const profitLoss = investment.currentValue - investment.amountInvested;
                    const profitLossPercent = ((profitLoss / investment.amountInvested) * 100).toFixed(2);
                    
                    totalInvested += investment.amountInvested;
                    totalCurrent += investment.currentValue;

                    return `
                        <div class="investment-card">
                            <div class="investment-actions">
                                <button class="action-btn" onclick="editInvestment('${investment.investmentId}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn" onclick="deleteInvestment('${investment.investmentId}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="investment-header">
                                <div>
                                    <div class="investment-name">${investment.name}</div>
                                    <div class="investment-type">${investment.type}</div>
                                </div>
                                <div class="investment-amount">
                                    <div class="amount-invested">₹${investment.amountInvested.toLocaleString()}</div>
                                    <div class="amount-label">Invested</div>
                                </div>
                            </div>
                            <div class="investment-details">
                                <div class="detail-item">
                                    <div class="detail-label">Current Value</div>
                                    <div class="detail-value">₹${investment.currentValue.toLocaleString()}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">P&L</div>
                                    <div class="detail-value ${profitLoss >= 0 ? 'positive' : 'negative'}">
                                        ${profitLoss >= 0 ? '+' : ''}₹${profitLoss.toLocaleString()} (${profitLossPercent}%)
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Purchase Date</div>
                                    <div class="detail-value">${investment.purchaseDate}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Days Held</div>
                                    <div class="detail-value">${calculateDaysHeld(investment.purchaseDate)}</div>
                                </div>
                            </div>
                            ${investment.notes ? `
                                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-subtle);">
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Notes:</div>
                                    <div style="font-size: 0.9rem; color: var(--text-primary); margin-top: 0.25rem;">${investment.notes}</div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');

                const totalProfitLoss = totalCurrent - totalInvested;
                const totalProfitLossPercent = ((totalProfitLoss / totalInvested) * 100).toFixed(2);

                portfolioContainer.innerHTML = `
                    <div class="portfolio-grid">
                        ${portfolioHTML}
                    </div>
                    <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(0, 0, 0, 0.3); border-radius: 12px; border: 1px solid var(--border-subtle);">
                        <h6 style="margin-bottom: 1rem; color: var(--text-primary);">Portfolio Summary</h6>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Invested</div>
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--neon-mint);">₹${totalInvested.toLocaleString()}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Current Value</div>
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--text-primary);">₹${totalCurrent.toLocaleString()}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Total P&L</div>
                                <div style="font-size: 1.2rem; font-weight: 600; ${totalProfitLoss >= 0 ? 'color: var(--neon-mint);' : 'color: var(--danger);'}">
                                    ${totalProfitLoss >= 0 ? '+' : ''}₹${totalProfitLoss.toLocaleString()} (${totalProfitLossPercent}%)
                                </div>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('Error loading investment portfolio:', error);
                portfolioContainer.innerHTML = `
                    <div class="empty-portfolio">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h6>Error Loading Portfolio</h6>
                        <p>Unable to load investment data</p>
                    </div>
                `;
            }
        }

        function editInvestment(investmentId) {
            const currentUser = authManager.getCurrentUser();
            const userData = finViewAdminDB.getUserData(currentUser.userId);
            const investment = userData?.investments?.find(inv => inv.investmentId === investmentId);
            
            if (!investment) {
                alert('Investment not found');
                return;
            }

            const newName = prompt('Enter new investment name:', investment.name);
            if (!newName) return;

            const newType = prompt('Enter new investment type:', investment.type);
            if (!newType) return;

            const newAmount = prompt('Enter new amount invested (₹):', investment.amountInvested);
            if (!newAmount || isNaN(newAmount) || parseFloat(newAmount) <= 0) {
                alert('Please enter a valid amount');
                return;
            }

            const newCurrentValue = prompt('Enter new current value (₹):', investment.currentValue);
            if (!newCurrentValue || isNaN(newCurrentValue) || parseFloat(newCurrentValue) < 0) {
                alert('Please enter a valid current value');
                return;
            }

            const newNotes = prompt('Enter new notes (optional):', investment.notes || '');

            try {
                finViewAdminDB.updateInvestment(currentUser.userId, investmentId, {
                    name: newName.trim(),
                    type: newType.trim(),
                    amountInvested: parseFloat(newAmount),
                    currentValue: parseFloat(newCurrentValue),
                    notes: newNotes ? newNotes.trim() : '',
                    updatedAt: new Date().toISOString()
                });

                finViewAdminDB.addActivityLog(currentUser.userId, {
                    page: 'User Profile',
                    action: 'Edit Investment',
                    description: `Updated ${newType}: ${newName}`
                });

                alert('Investment updated successfully!');
                loadInvestmentPortfolio();
            } catch (error) {
                console.error('Error updating investment:', error);
                alert('Error updating investment. Please try again.');
            }
        }

        function deleteInvestment(investmentId) {
            if (!confirm('Are you sure you want to delete this investment? This action cannot be undone.')) {
                return;
            }

            const currentUser = authManager.getCurrentUser();
            
            try {
                const userData = finViewAdminDB.getUserData(currentUser.userId);
                const investment = userData?.investments?.find(inv => inv.investmentId === investmentId);
                
                if (!investment) {
                    alert('Investment not found');
                    return;
                }

                finViewAdminDB.deleteInvestment(currentUser.userId, investmentId);

                finViewAdminDB.addActivityLog(currentUser.userId, {
                    page: 'User Profile',
                    action: 'Delete Investment',
                    description: `Deleted ${investment.type}: ${investment.name}`
                });

                alert('Investment deleted successfully!');
                loadInvestmentPortfolio();
            } catch (error) {
                console.error('Error deleting investment:', error);
                alert('Error deleting investment. Please try again.');
            }
        }

        function calculateDaysHeld(purchaseDate) {
            const purchase = new Date(purchaseDate);
            const today = new Date();
            const diffTime = Math.abs(today - purchase);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function isValidDate(dateString) {
            const date = new Date(dateString);
            return date instanceof Date && !isNaN(date) && dateString.match(/^\d{4}-\d{2}-\d{2}$/);
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR'
            }).format(amount);
        }

        function getStatusIcon(status) {
            const icons = {
                'on-track': 'fa-check-circle text-warning',
                'over': 'fa-exclamation-circle text-danger',
                'under': 'fa-check-circle text-success'
            };
            return icons[status] || 'fa-circle text-secondary';
        }
    </script>
</body>
</html>